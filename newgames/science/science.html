<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Science Experiment</title>
<link rel="icon" href="../../icon.jpg" type="image/x-icon">
<link href="https://fonts.googleapis.com/css2?family=Jura:wght@500&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: radial-gradient(circle at 50% 50%, #0a0a0f, #1f1c34, #2c2a5e);
    font-family: 'Jura', sans-serif;
    color: white;
  }
  canvas {
    display: block;
  }
  #score {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 28px;
    font-weight: bold;
    text-shadow: 0 0 8px #0ff;
  }
  #waveInfo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 32px;
    color: #FF6;
    text-shadow: 0 0 10px #FF6;
    white-space: pre;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="waveInfo"></div>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
// some stuff
let score = 0;
let gameOver = false;
let shake = 0;

// Wave system
let wave = 1;
let waveActive = false;
let contaminantsPerWave = 5;
let nextWaveDelay = 2000;

// Player
const particle = {
  x: canvas.width / 2,
  y: canvas.height - 100,
  radius: 20,
  color: '#39FF14',
  dx: 0,
  speed: 8
};

// Contaminants
let contaminants = [];
function createContaminant() {
  const size = Math.random() * 25 + 15;
  contaminants.push({
    x: Math.random() * (canvas.width - size),
    y: -size,
    radius: size,
    color: `hsl(${Math.random()*360}, 80%, 60%)`,
    speed: Math.random() * (2 + wave) + 2
  });
}

// Power-ups
let powerUps = [];
function createPowerUp() {
  const size = 15;
  powerUps.push({
    x: Math.random() * (canvas.width - size),
    y: -size,
    radius: size,
    color: '#FFD700',
    speed: 4
  });
}

// Movement
document.addEventListener('keydown', e => {
  if(e.key === 'ArrowLeft') particle.dx = -particle.speed;
  if(e.key === 'ArrowRight') particle.dx = particle.speed;
});
document.addEventListener('keyup', e => {
  if(e.key === 'ArrowLeft' || e.key === 'ArrowRight') particle.dx = 0;
});

// Collision
function checkCollision(a, b) {
  const dx = a.x - b.x;
  const dy = a.y - b.y;
  return Math.sqrt(dx*dx + dy*dy) < a.radius + b.radius;
}

// Typing effect for next wave
async function showWaveInfo(text) {
  const waveDiv = document.getElementById('waveInfo');
  waveDiv.textContent = '';
  for (let i = 0; i < text.length; i++) {
    waveDiv.textContent += text[i];
    await new Promise(r => setTimeout(r, 50));
  }
  setTimeout(() => waveDiv.textContent = '', 1000);
}

// Start a new wave
async function startWave() {
  waveActive = false;
  await showWaveInfo(`WAVE ${wave} INCOMING`);
  waveActive = true;
  contaminantsPerWave = Math.min(5 + wave * 2, 50); // increase difficulty
}

// Game loop
function update() {
  if(gameOver) return;

  const shakeX = shake ? (Math.random()*shake - shake/2) : 0;
  const shakeY = shake ? (Math.random()*shake - shake/2) : 0;
  ctx.setTransform(1,0,0,1,shakeX,shakeY);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Move player
  particle.x += particle.dx;
  if(particle.x - particle.radius < 0) particle.x = particle.radius;
  if(particle.x + particle.radius > canvas.width) particle.x = canvas.width - particle.radius;

  // Draw player
  ctx.save();
  ctx.shadowBlur = 20;
  ctx.shadowColor = particle.color;
  ctx.beginPath();
  ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI*2);
  ctx.fillStyle = particle.color;
  ctx.fill();
  ctx.restore();

  // Spawn contaminants if wave active
  if(waveActive && contaminants.length < contaminantsPerWave && Math.random() < 0.05) createContaminant();

  contaminants.forEach((c, i) => {
    c.y += c.speed;
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.radius, 0, Math.PI*2);
    ctx.fillStyle = c.color;
    ctx.shadowBlur = 15;
    ctx.shadowColor = c.color;
    ctx.fill();

    if(checkCollision(particle, c)) {
      gameOver = true;
      shake = 20;
      setTimeout(() => alert('Game Over! Final Score: ' + score), 100);
    }

    if(c.y - c.radius > canvas.height) {
      contaminants.splice(i, 1);
      score++;
      document.getElementById('score').innerText = 'Score: ' + score;
    }
  });

  // Spawn power-ups
  if(Math.random() < 0.002) createPowerUp();
  powerUps.forEach((p, i) => {
    p.y += p.speed;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
    ctx.fillStyle = p.color;
    ctx.shadowBlur = 20;
    ctx.shadowColor = p.color;
    ctx.fill();

    if(checkCollision(particle, p)) {
      score += 5;
      powerUps.splice(i,1);
      document.getElementById('score').innerText = 'Score: ' + score;
      shake = 10;
      setTimeout(() => shake=0, 200);
    }

    if(p.y - p.radius > canvas.height) powerUps.splice(i,1);
  });

  if(shake > 0) shake *= 0.9;

  // Start next wave if all contaminants cleared
  if(waveActive && contaminants.length === 0) {
    wave++;
    waveActive = false;
    setTimeout(startWave, nextWaveDelay);
  }

  requestAnimationFrame(update);
}

// Initialize
startWave();
update();
</script>
</body>
</html>
