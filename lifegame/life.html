<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wealth ‚Äî Fixed</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="check.png" />
  <style>
    /* filepath: d:\Misc\Coding\Repositories\website\lifegame\life.html - simplified and functional styles */
    body { background: linear-gradient(180deg,#eef2fb,#f7f9ff); font-family: "Segoe UI", Tahoma, sans-serif; color:#123; margin:0; padding:24px; display:flex; justify-content:center; }
    .card { width:960px; max-width:96%; background:#fff; border-radius:12px; padding:18px; box-shadow:0 8px 30px rgba(10,20,50,0.06); }
    h1 { color:#148A2DCC; margin:0 0 8px 0; font-size:1.6rem; }
    h2 { margin:6px 0 16px; font-size:1.1rem; color:#333; }
    .controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px; }
    button{ background:#6e8efb; color:#fff; border:0; padding:10px 12px; border-radius:8px; cursor:pointer; }
    button.disabled { background:#ccc; cursor:not-allowed; }
    #taskArea { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; }
    input { padding:6px; font-size:15px; border-radius:6px; border:1px solid #ddd; }
    #message { min-height:22px; font-weight:bold; margin-top:10px; opacity:1; color:#444; }
    .panels { display:flex; gap:12px; margin-top:14px; flex-wrap:wrap; }
    .panel { flex:1; min-width:260px; border:1px solid #eef; padding:12px; border-radius:8px; background:#fbfdff; }
    .row { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #eef; }
    .small { font-size:0.9rem; color:#666; }
    @media(max-width:760px){ .panels{flex-direction:column} }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>üí∞ Wealth</h1>
    <h2 id="money">Money: $1</h2>

    <div class="controls">
      <button id="taskBtn">Do Task (+$5)</button>
      <button id="freelanceBtn">Freelance (+$random)</button>
      <button id="investBtn">Invest $10 (requires $10)</button>
      <button id="saveBtn" style="background:#4caf50">Save</button>
      <button id="loadBtn" style="background:#888">Load</button>
    </div>

    <div id="message" aria-live="polite"></div>

    <div class="panels">
      <div class="panel">
        <h3>Income</h3>
        <div class="row"><div>Passive income</div><div id="passive">$0 / s</div></div>
        <div class="row"><div>Last reward</div><div id="lastReward">$0</div></div>
      </div>

      <div class="panel">
        <h3>Opportunities</h3>
        <div class="row"><div>Investments</div><div id="investCount">0</div></div>
        <div class="row"><div>Freelance gigs</div><div id="gigCount">0</div></div>
      </div>

      <div class="panel">
        <h3>Market</h3>
        <div class="row"><div>Stocks (demo)</div><div id="marketIndex">Stable</div></div>
        <div style="margin-top:12px;" class="small">Tip: Invest to increase passive income. Freelance gives randomness.</div>
      </div>
    </div>
  </div>

  <script>
    // Simple working life/wealth demo with autosave
    const MONEY_KEY = 'wealth_save_v1';
    const state = {
      money: 1,
      passive: 0,
      investments: 0,
      gigs: 0,
      lastReward: 0
    };

    const moneyEl = document.getElementById('money');
    const passiveEl = document.getElementById('passive');
    const investBtn = document.getElementById('investBtn');
    const taskBtn = document.getElementById('taskBtn');
    const freelanceBtn = document.getElementById('freelanceBtn');
    const lastRewardEl = document.getElementById('lastReward');
    const investCountEl = document.getElementById('investCount');
    const gigCountEl = document.getElementById('gigCount');
    const messageEl = document.getElementById('message');
    const marketIndexEl = document.getElementById('marketIndex');

    function fmt(n){ return '$' + Math.floor(n).toLocaleString(); }

    function load(){
      try {
        const s = localStorage.getItem(MONEY_KEY);
        if(s){ Object.assign(state, JSON.parse(s)); show('Autosave loaded'); }
      } catch(e){ console.warn('load failed', e); }
      render();
    }
    function save(){ localStorage.setItem(MONEY_KEY, JSON.stringify(state)); show('Saved'); }

    function show(txt, ms=2200){
      messageEl.textContent = txt;
      clearTimeout(messageEl._t);
      messageEl._t = setTimeout(()=> { if(messageEl.textContent === txt) messageEl.textContent = ''; }, ms);
    }

    function render(){
      moneyEl.textContent = 'Money: ' + fmt(state.money);
      passiveEl.textContent = fmt(state.passive) + ' / s';
      lastRewardEl.textContent = fmt(state.lastReward);
      investCountEl.textContent = state.investments;
      gigCountEl.textContent = state.gigs;
      investBtn.classList.toggle('disabled', state.money < 10);
      marketIndexEl.textContent = Math.random() < 0.5 ? 'Stable' : (Math.random()<0.5?'Bullish':'Volatile');
    }

    // Buttons
    taskBtn.addEventListener('click', ()=> {
      const earn = 5;
      state.money += earn;
      state.lastReward = earn;
      show('Task completed: +' + fmt(earn));
      render();
    });

    freelanceBtn.addEventListener('click', ()=> {
      const earn = Math.floor(Math.random()*40) + 2;
      state.money += earn;
      state.gigs++;
      state.lastReward = earn;
      show('Freelance paid +' + fmt(earn));
      render();
    });

    investBtn.addEventListener('click', ()=> {
      if(state.money < 10){ show('Not enough money'); return; }
      state.money -= 10;
      state.investments++;
      // Each investment increases passive income slightly
      state.passive = Math.round((state.passive + 0.6) * 100) / 100;
      show('Invested $10 ‚Äî passive income increased');
      render();
    });

    document.getElementById('saveBtn').addEventListener('click', save);
    document.getElementById('loadBtn').addEventListener('click', ()=> { load(); show('Loaded'); });

    // Passive income tick
    setInterval(()=> {
      if(state.passive > 0){
        state.money += state.passive;
        state.lastReward = state.passive;
      }
      // small market movement
      if(Math.random() < 0.04) {
        // passive may gain/lose small percent
        const change = (Math.random()-0.5) * 0.1;
        state.passive = Math.max(0, Math.round((state.passive * (1 + change)) * 100) / 100);
      }
      save(); // autosave each tick
      render();
    }, 1000);

    // Load on start
    load();
  </script>
</body>
</html>
      ],
      assets: [
        { name:"Stock Portfolio", cost:1000, growthPerMin:0.10, owned:0 },
        { name:"Real Estate", cost:5000, growthPerMin:0.20, owned:0 },
        { name:"Tech Startup", cost:10000, growthPerMin:0.50, owned:0 }
      ],
      market: {
        items: [
          { name:"Coffee Beans", basePrice:15, volatility:0.3, currentPrice:15, owned:0 },
          { name:"Tech Gadgets", basePrice:30, volatility:0.5, currentPrice:30, owned:0 },
          { name:"Rare Gems", basePrice:50, volatility:0.7, currentPrice:50, owned:0 },
          { name:"Art Pieces", basePrice:75, volatility:0.4, currentPrice:75, owned:0 },
          { name:"Gold Bars", basePrice:100, volatility:0.8, currentPrice:100, owned:0 },
          { name:"Electronics", basePrice:45, volatility:0.4, currentPrice:45, owned:0 }
        ],
        lastUpdate: performance.now()
      },
      crafting: {
        recipes: [
          { name:"Premium Coffee", ingredients:[{name:"Coffee Beans",amount:3}], value:60 },
          { name:"Smart Device", ingredients:[{name:"Tech Gadgets",amount:2}], value:80 },
          { name:"Jewelry", ingredients:[{name:"Rare Gems",amount:2}], value:150 },
          { name:"Masterpiece", ingredients:[{name:"Art Pieces",amount:2}], value:200 },
          { name:"Gold Jewelry", ingredients:[{name:"Gold Bars",amount:1},{name:"Rare Gems",amount:1}], value:250 },
          { name:"Smart Watch", ingredients:[{name:"Electronics",amount:2},{name:"Tech Gadgets",amount:1}], value:120 }
        ]
      },
      cooldownsBase: {
        free: 10, partTime: 15, stock: 20, task: 5, consulting: 30, crypto: 45, startup: 60
      },
      tasksCompleted: 0,
      freeMoneyUses: 0
    };

    // ---------- Utilities ----------
    function formatMoney(n) {
      return '$' + Number(n).toLocaleString(undefined, {minimumFractionDigits:0, maximumFractionDigits:2});
    }

    // ---------- Cooldown system ----------
    const buttonCooldowns = new Map(); // button -> {endTime, originalText}

    function startCooldown(button, seconds) {
      if (!button || seconds <= 0) {
        return;
      }
      // remember original label if not set
      if (!button.dataset.originalText) button.dataset.originalText = button.textContent;
      button.disabled = true;
      const endTime = Date.now() + seconds * 1000;
      buttonCooldowns.set(button, { endTime, originalText: button.dataset.originalText });
    }

    function updateCooldowns() {
      const now = Date.now();
      for (const [button, meta] of Array.from(buttonCooldowns.entries())) {
        const remaining = Math.ceil((meta.endTime - now) / 1000);
        if (remaining > 0) {
          button.textContent = `Wait ${remaining}s`;
        } else {
          button.disabled = false;
          button.textContent = meta.originalText;
          buttonCooldowns.delete(button);
        }
      }
    }

    // ---------- Money handling ----------
    function changeMoney(amount, source) {
      const old = state.money;
      state.money = Math.max(0, Math.round((Number(state.money) + Number(amount)) * 100) / 100);
      if (old !== state.money) {
        showMessage(`${amount > 0 ? '+' : ''}${formatMoney(amount)} ${source ? '('+source+')' : ''}`, amount > 0);
        updateUI();
      }
    }

    // ---------- UI updates ----------
    let uiPending = false;
    function updateUI() {
      if (uiPending) return;
      uiPending = true;
      requestAnimationFrame(()=> {
        elements.money.textContent = `Money: ${formatMoney(state.money)}`;
        // invest button
        elements.investBtn.classList.toggle('disabled', state.money < state.investmentCost);
        elements.investBtn.disabled = state.money < state.investmentCost;
        elements.investBtn.textContent = `Invest $${state.investmentCost}`;
        // opportunities and panels unlock
        elements.opportunities.style.display = state.money >= 25 ? 'block' : 'none';
        elements.highTierOpportunities.style.display = state.money >= 75 ? 'block' : 'none';
        elements.marketSection.style.display = state.money >= 250 ? 'block' : 'none';
        elements.craftingPanel.style.display = state.money >= 500 ? 'block' : 'none';
        elements.buildingPanel.style.display = state.money >= 1000 ? 'block' : 'none';
        elements.investingPanel.style.display = state.money >= 2500 ? 'block' : 'none';
        // market, crafting, buildings and assets lists
        renderMarket();
        renderCrafting();
        renderBuildings();
        renderAssets();
        uiPending = false;
      });
    }

    // ---------- Market ----------
    function renderMarket() {
      if (state.money < 250) return;
      elements.marketGrid.innerHTML = state.market.items.map(item => `
        <div class="market-item">
          <div style="text-align:left">
            <div><strong>${item.name}</strong></div>
            <div>Price: ${formatMoney(item.currentPrice)}</div>
            <div>Owned: ${item.owned}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button onclick="buyItem('${item.name}')" ${state.money < item.currentPrice ? 'disabled' : ''}>Buy</button>
            <button onclick="sellItem('${item.name}')" ${item.owned===0 ? 'disabled' : ''}>Sell</button>
          </div>
        </div>
      `).join('');
    }

    function buyItem(name) {
      const item = state.market.items.find(i => i.name === name);
      if (!item) return;
      if (state.money >= item.currentPrice) {
        changeMoney(-item.currentPrice, 'market-buy');
        item.owned++;
        showMessage(`Bought ${item.name} for ${formatMoney(item.currentPrice)}`, true);
        updateUI();
      }
    }
    function sellItem(name) {
      const item = state.market.items.find(i => i.name === name);
      if (!item || item.owned <= 0) return;
      changeMoney(item.currentPrice, 'market-sell');
      item.owned--;
      showMessage(`Sold ${item.name} for ${formatMoney(item.currentPrice)}`, true);
      updateUI();
    }

    // market price updates
    function tickMarketPrices(now) {
      const interval = 5000; // every 5s
      if (now - state.market.lastUpdate >= interval) {
        state.market.items.forEach(item => {
          const change = (Math.random() - 0.5) * item.volatility * item.basePrice;
          const next = Math.round(item.currentPrice + change);
          item.currentPrice = Math.max( Math.round(item.basePrice * 0.4), next );
        });
        state.market.lastUpdate = now;
        updateUI();
      }
    }

    // ---------- Crafting ----------
    function renderCrafting() {
      if (state.money < 500) return;
      elements.recipeGrid.innerHTML = state.crafting.recipes.map(r => {
        const canCraft = r.ingredients.every(ing => {
          const it = state.market.items.find(i=>i.name===ing.name);
          return it && it.owned >= ing.amount;
        });
        return `
          <div class="recipe-item">
            <div style="text-align:left">
              <div><strong>${r.name}</strong> ‚Äî Sells for ${formatMoney(r.value)}</div>
              <div>Requires: ${r.ingredients.map(i=>`${i.amount}x ${i.name}`).join(', ')}</div>
            </div>
            <div><button onclick="craftItem('${r.name}')" ${canCraft ? '' : 'disabled'}>Craft</button></div>
          </div>
        `;
      }).join('');
    }

    function craftItem(name) {
      const recipe = state.crafting.recipes.find(r=>r.name===name);
      if (!recipe) return;
      const canCraft = recipe.ingredients.every(ing => {
        const it = state.market.items.find(i=>i.name===ing.name);
        return it && it.owned >= ing.amount;
      });
      if (!canCraft) {
        showMessage('Not enough ingredients', false);
        return;
      }
      recipe.ingredients.forEach(ing => {
        const it = state.market.items.find(i=>i.name===ing.name);
        it.owned -= ing.amount;
      });
      changeMoney(recipe.value, 'crafting');
      showMessage(`üõ†Ô∏è Crafted ${recipe.name}`, true);
      updateUI();
    }

    // ---------- Buildings ----------
    function renderBuildings() {
      if (state.money < 1000) return;
      elements.buildingGrid.innerHTML = state.buildings.map(b => `
        <div class="building-item">
          <div style="text-align:left">
            <div><strong>${b.name}</strong></div>
            <div>Cost: ${formatMoney(b.cost)} ‚Ä¢ Income: ${b.incomePerMin}/min</div>
            <div>Owned: ${b.owned}</div>
          </div>
          <div><button onclick="buyBuilding('${b.name}')" ${state.money < b.cost ? 'disabled' : ''}>Buy</button></div>
        </div>
      `).join('');
    }
    function buyBuilding(name) {
      const b = state.buildings.find(x=>x.name===name);
      if (!b || state.money < b.cost) return;
      changeMoney(-b.cost, 'building-buy');
      b.owned++;
      showMessage(`üèóÔ∏è Purchased ${b.name}`, true);
      updateUI();
    }

    // ---------- Assets ----------
    function renderAssets() {
      if (state.money < 2500) return;
      elements.assetGrid.innerHTML = state.assets.map(a => `
        <div class="asset-item">
          <div style="text-align:left">
            <div><strong>${a.name}</strong></div>
            <div>Cost: ${formatMoney(a.cost)} ‚Ä¢ Growth: ${Math.round(a.growthPerMin*100)}%/min</div>
            <div>Owned: ${a.owned}</div>
          </div>
          <div><button onclick="buyAsset('${a.name}')" ${state.money < a.cost ? 'disabled' : ''}>Buy</button></div>
        </div>
      `).join('');
    }
    function buyAsset(name) {
      const a = state.assets.find(x=>x.name===name);
      if (!a || state.money < a.cost) return;
      changeMoney(-a.cost, 'asset-buy');
      a.owned++;
      showMessage(`üíπ Invested in ${a.name}`, true);
      updateUI();
    }

    // ---------- Task system ----------
    elements.taskBtn.addEventListener('click', generateTask);

    elements.taskArea.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'submitTask') {
        handleTaskSubmission(e.target);
      }
    });

    function generateTask() {
      elements.taskBtn.disabled = false; // allow generation unless on cooldown
      elements.taskArea.innerHTML = '';
      const type = Math.random() < 0.5 ? 'math' : 'word';
      const difficulty = Math.min(Math.floor(state.tasksCompleted / 10), 3);

      if (type === 'math') {
        const ops = ['+','-','*'];
        const op = ops[Math.floor(Math.random()* (difficulty>1 ? 3 : 1))];
        const a = Math.floor(Math.random()*(10*(difficulty+1)));
        const b = Math.floor(Math.random()*(10*(difficulty+1)));
        // safe compute:
        let answer = 0;
        if (op==='+') answer = a + b;
        else if (op==='-') answer = a - b;
        else answer = a * b;

        elements.taskArea.innerHTML = `
          <div style="margin:8px 0;">Solve: <strong>${a} ${op} ${b}</strong>
            <br><input id="answer" type="number" style="width:90px">
            <button id="submitTask" data-answer="${answer}">Submit</button>
          </div>
        `;
      } else {
        const words = [
          ["code","game","task"],
          ["money","wealth","invest"],
          ["javascript","business","success"],
          ["entrepreneur","innovation","technology"]
        ];
        const word = words[difficulty][Math.floor(Math.random()*3)];
        elements.taskArea.innerHTML = `
          <div style="margin:8px 0;">Type this word: <b>${word}</b><br>
            <input id="wordInput" type="text" style="width:160px">
            <button id="submitTask" data-word="${word}">Submit</button>
          </div>
        `;
      }
      // put task button on cooldown
      startCooldown(elements.taskBtn, state.cooldownsBase.task);
    }

    function handleTaskSubmission(button) {
        const isWord = button.dataset.word !== undefined;
        const input = document.getElementById(isWord ? 'wordInput' : 'answer');
        if (!input) return;
        const val = input.value.trim();
        if (!val) return;

        let correct = false;
        if (isWord) {
          correct = val.toLowerCase() === button.dataset.word.toLowerCase();
        } else {
          correct = Number(val) === Number(button.dataset.answer);
        }

        if (correct) {
          changeMoney(1, 'task-complete');
          state.tasksCompleted++;
          showMessage('‚ú® Well done! You earned $1.', true);
          const cd = Math.min(30, 5 + Math.floor(state.tasksCompleted / 1));
          startCooldown(elements.taskBtn, cd);
          elements.taskArea.innerHTML = ''; // clear task after completion ‚úÖ
        } else {
          showMessage('‚ùå Wrong answer. Try again!', false);
        }
        updateUI();
      }

    // ---------- Buttons: freelance, invest, opportunities ----------
    elements.freelanceBtn.addEventListener('click', () => {
      if (elements.freelanceBtn.disabled) return;
      changeMoney(5, 'freelance');
      state.freeMoneyUses++;
      startCooldown(elements.freelanceBtn, state.cooldownsBase.free + (state.freeMoneyUses * 5));
    });

    elements.investBtn.addEventListener('click', () => {
      if (elements.investBtn.disabled) return;
      if (state.money >= state.investmentCost) {
        changeMoney(-state.investmentCost, 'investment');
        state.investments++;
        // increase cost modestly
        state.investmentCost = Math.round((state.investmentCost + 5) * 100) / 100;
        showMessage(`üìä You bought an investment (#${state.investments})`, true);
        updateUI();
      }
    });

    elements.partTimeBtn.addEventListener('click', () => {
      if (elements.partTimeBtn.disabled) return;
      changeMoney(10, 'part-time');
      showMessage('üõ†Ô∏è You worked a part-time job and earned $10!', true);
      startCooldown(elements.partTimeBtn, state.cooldownsBase.partTime);
    });

    elements.stockBtn.addEventListener('click', () => {
      if (elements.stockBtn.disabled) return;
      const win = Math.random() < 0.5;
      changeMoney(win ? 20 : -10, 'stock');
      showMessage(win ? 'üìà Lucky! +$20' : 'üìâ Ouch! -$10', win);
      startCooldown(elements.stockBtn, state.cooldownsBase.stock);
    });

    elements.consultingBtn.addEventListener('click', () => {
      if (elements.consultingBtn.disabled) return;
      changeMoney(30, 'consulting');
      showMessage('üíº Consulting completed! +$30', true);
      startCooldown(elements.consultingBtn, state.cooldownsBase.consulting);
    });

    elements.cryptoBtn.addEventListener('click', () => {
      if (elements.cryptoBtn.disabled) return;
      const win = Math.random() < 0.3;
      changeMoney(win ? 50 : -25, 'crypto');
      showMessage(win ? 'üöÄ Crypto success! +$50' : 'üí• Crypto crash! -$25', win);
      startCooldown(elements.cryptoBtn, state.cooldownsBase.crypto);
    });

    elements.startupBtn.addEventListener('click', () => {
      if (elements.startupBtn.disabled) return;
      if (state.money < 50) { showMessage('Not enough money to launch startup', false); return; }
      changeMoney(-50, 'startup');
      state.startups++;
      showMessage('üöÄ Startup launched! Generates passive income.', true);
      startCooldown(elements.startupBtn, state.cooldownsBase.startup);
    });

    // ---------- Game loop (single, stable) ----------
    let lastTick = performance.now();
    function loop(now) {
      const deltaMs = now - lastTick;
      const deltaSec = deltaMs / 1000;
      // 1) update cooldown displays
      updateCooldowns();

      // 2) passive income continuous calculation
      if (deltaSec > 0) {
        // investments
        if (state.investments > 0) {
          changeMoney(state.investments * state.investmentsYieldPerSec * deltaSec, 'investments');
        }
        // startups
        if (state.startups > 0) {
          changeMoney(state.startups * state.startupYieldPerSec * deltaSec, 'startups');
        }
        // buildings: incomePerMin -> per second = incomePerMin / 60
        state.buildings.forEach(b => {
          if (b.owned > 0) {
            changeMoney((b.incomePerMin/60) * b.owned * deltaSec, 'buildings');
          }
        });
        // assets: growthPerMin applied proportionally to current money
        state.assets.forEach(a => {
          if (a.owned > 0) {
            const perSecRate = a.growthPerMin / 60; // e.g. 0.1/min -> 0.001666.../sec
            const growth = state.money * (perSecRate * a.owned) * deltaSec;
            // small threshold to avoid spamming tiny changes
            if (growth >= 0.01) changeMoney(growth, 'assets');
          }
        });
      }

      // 3) market price updates
      tickMarketPrices(now);

      lastTick = now;
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // ---------- Message display ----------
    let msgTimeout = null;
    function showMessage(text, success = true) {
      if (msgTimeout) {
        clearTimeout(msgTimeout);
        msgTimeout = null;
      }
      elements.message.textContent = text;
      elements.message.className = success ? 'task-success' : 'task-error';
      elements.message.style.opacity = '1';
      msgTimeout = setTimeout(()=> {
        elements.message.style.opacity = '0';
      }, 2200);
    }

    // ---------- Initial render and small housekeeping ----------
    // set original text data attributes so cooldown restores labels correctly
    [elements.taskBtn, elements.freelanceBtn, elements.investBtn, elements.partTimeBtn,
     elements.stockBtn, elements.consultingBtn, elements.cryptoBtn, elements.startupBtn].forEach(b=>{
       if (b) b.dataset.originalText = b.textContent;
    });

    // show/hide panels initially
    updateUI();

    // expose a couple helper functions to global for dynamic button onclicks inside strings
    window.buyItem = buyItem;
    window.sellItem = sellItem;
    window.craftItem = craftItem;
    window.buyBuilding = buyBuilding;
    window.buyAsset = buyAsset;

    // small courtesy: start with a short guiding message
    showMessage('Welcome! Click "Do Task" to begin and unlock more features as you earn.', true);
  </script>
</body>
</html>
