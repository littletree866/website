<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack+</title>
    <link rel="icon" type="image/x-icon" href="../../icon.jpg">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #4eb6ff;
            --win-color: #4caf50;
            --lose-color: #e91e63;
            --push-color: #ffeb3b;
            --background-dark: #0b0b0f;
            --card-bg: #1a1a24;
            --card-border: #2a2a3a;
            --text-light: #f0f0f0;
            --shadow-color: rgba(78, 182, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            margin: 0;
            background: radial-gradient(circle, var(--background-dark), #000);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        #game {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            padding: 25px;
            border-radius: 14px;
            box-shadow: 0 0 30px var(--shadow-color);
            text-align: center;
            border: 1px solid var(--card-border);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--card-border);
        }

        h2 {
            color: var(--primary-color);
            letter-spacing: 1px;
            font-weight: 700;
            font-size: 28px;
        }

        #chips {
            font-size: 18px;
            font-weight: 600;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid var(--primary-color);
        }

        #chipCount {
            color: var(--primary-color);
        }

        .section-title {
            margin-top: 20px;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            text-align: left;
            padding-left: 5px;
        }

        .card-zone {
            min-height: 85px;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 70px;
            height: 95px;
            background: #fff;
            color: #000;
            border-radius: 8px;
            font-size: 24px;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            font-weight: 700;
        }

        .card.red {
            color: #d32f2f;
        }

        .card.black {
            color: #212121;
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 6px 12px rgba(255, 255, 255, 0.15);
        }

        .card-suit {
            font-size: 18px;
            margin-top: 5px;
        }

        .hidden-card {
            background: linear-gradient(135deg, #444, #222);
            color: transparent;
            position: relative;
            overflow: hidden;
        }

        .hidden-card::after {
            content: "?";
            position: absolute;
            color: rgba(255, 255, 255, 0.7);
            font-size: 32px;
            font-weight: 700;
        }

        .hand-total {
            font-size: 20px;
            font-weight: 600;
            margin: 10px 0;
            text-align: left;
            padding-left: 5px;
        }

        .buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin: 25px 0;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'DM Sans', sans-serif;
            min-width: 130px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        #hit {
            background: var(--win-color);
            color: white;
        }

        #stand {
            background: var(--lose-color);
            color: white;
        }

        #restart {
            background: var(--primary-color);
            color: white;
        }

        #double {
            background: #ff9800;
            color: white;
            display: none;
        }

        #result {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .win {
            color: var(--win-color);
            text-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        .lose {
            color: var(--lose-color);
            text-shadow: 0 0 8px rgba(233, 30, 99, 0.5);
        }

        .push {
            color: var(--push-color);
            text-shadow: 0 0 8px rgba(255, 235, 59, 0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
        }

        .bet-info {
            margin-bottom: 10px;
            font-size: 16px;
        }

        .accessibility-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--card-border);
        }

        .accessibility-btn {
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 12px;
            font-size: 14px;
            min-width: auto;
        }

        .accessibility-btn:hover {
            background: rgba(78, 182, 255, 0.1);
        }

        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--primary-color);
            font-size: 24px;
            cursor: pointer;
            min-width: auto;
            padding: 8px;
        }

        /* Mobile responsiveness */
        @media (max-width: 600px) {
            #game {
                padding: 20px 15px;
            }
            
            .card {
                width: 60px;
                height: 85px;
                font-size: 20px;
            }
            
            .card-suit {
                font-size: 16px;
            }
            
            button {
                min-width: 110px;
                padding: 10px 15px;
                font-size: 16px;
            }
            
            h2 {
                font-size: 24px;
            }
            
            .buttons {
                gap: 8px;
            }
        }

        @media (max-width: 400px) {
            .game-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .buttons {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 250px;
            }
        }

        /* Animation for card dealing */
        @keyframes dealCard {
            0% { transform: translateY(-30px) rotate(-5deg); opacity: 0; }
            100% { transform: translateY(0) rotate(0); opacity: 1; }
        }

        .card-dealing {
            animation: dealCard 0.4s ease-out;
        }

        /* High contrast mode */
        .high-contrast {
            --primary-color: #00ffff;
            --win-color: #00ff00;
            --lose-color: #ff0000;
            --push-color: #ffff00;
            --background-dark: #000;
            --card-bg: #111;
            --card-border: #fff;
            --text-light: #fff;
            --shadow-color: rgba(0, 255, 255, 0.5);
        }

        .high-contrast .card {
            border: 2px solid white;
        }
    </style>
</head>

<body>
    <button id="soundToggle" class="sound-toggle" aria-label="Toggle sound">
        <i class="fas fa-volume-up"></i>
    </button>
    
    <div id="game">
        <div class="game-header">
            <h2>♠️ BLACKJACK+ ♣️</h2>
            <div id="chips">CHIPS: <span id="chipCount">100</span></div>
        </div>

        <div class="bet-info">Current Bet: <span id="currentBet">10</span> chips</div>

        <div class="section-title">DEALER</div>
        <div id="dealerCards" class="card-zone"></div>
        <div id="dealerTotal" class="hand-total"></div>

        <div class="section-title">PLAYER</div>
        <div id="playerCards" class="card-zone"></div>
        <div id="playerTotal" class="hand-total"></div>

        <div class="buttons">
            <button id="hit">
                <i class="fas fa-plus-circle"></i> HIT
            </button>
            <button id="stand">
                <i class="fas fa-hand-paper"></i> STAND
            </button>
            <button id="double">
                <i class="fas fa-times-circle"></i> DOUBLE
            </button>
            <button id="restart">
                <i class="fas fa-redo"></i> NEW GAME
            </button>
        </div>

        <div id="result"></div>

        <div class="game-info">
            <div>Cards remaining: <span id="deckCount">52</span></div>
            <div>Games played: <span id="gamesPlayed">0</span></div>
        </div>

        <div class="accessibility-bar">
            <button id="highContrast" class="accessibility-btn">
                <i class="fas fa-adjust"></i> High Contrast
            </button>
            <button id="helpBtn" class="accessibility-btn">
                <i class="fas fa-question-circle"></i> Help
            </button>
            <button id="betBtn" class="accessibility-btn">
                <i class="fas fa-coins"></i> Change Bet
            </button>
        </div>
    </div>

    <script>
        // Game variables
        const suits = ["♠️", "♣️", "♥️", "♦️"];
        const ranks = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
        
        let deck = [];
        let player = [];
        let dealer = [];
        let chips = 100;
        let dealerHidden = true;
        let gameActive = false;
        let currentBet = 10;
        let gamesPlayed = 0;
        let soundEnabled = true;
        let highContrastMode = false;
        
        // Initialize game
        function initGame() {
            createDeck();
            updateChips();
            updateDeckCount();
            document.getElementById("currentBet").textContent = currentBet;
            document.getElementById("gamesPlayed").textContent = gamesPlayed;
            startGame();
        }
        
        function createDeck() {
            deck = [];
            for (let s of suits) {
                for (let r of ranks) {
                    // Determine card color
                    const isRed = s === "♥️" || s === "♦️";
                    deck.push({ 
                        rank: r, 
                        suit: s, 
                        color: isRed ? "red" : "black" 
                    });
                }
            }
            
            // Shuffle deck
            for (let i = deck.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            updateDeckCount();
        }
        
        function cardValue(c) {
            if (c.rank === "A") return 11;
            if (["J", "Q", "K"].includes(c.rank)) return 10;
            return parseInt(c.rank);
        }
        
        function handTotal(hand) {
            let total = hand.reduce((t, c) => t + cardValue(c), 0);
            let aces = hand.filter(c => c.rank === "A").length;
            
            while (total > 21 && aces > 0) {
                total -= 10;
                aces--;
            }
            return total;
        }
        
        function renderCards(container, cards, hidden) {
            container.innerHTML = "";
            cards.forEach((c, i) => {
                const div = document.createElement("div");
                div.className = `card ${c.color}`;
                
                if (hidden && i === 0) {
                    div.classList.add("hidden-card");
                } else {
                    div.innerHTML = `<div>${c.rank}</div><div class="card-suit">${c.suit}</div>`;
                }
                
                // Add dealing animation
                if (i === cards.length - 1 && gameActive) {
                    div.classList.add("card-dealing");
                }
                
                container.appendChild(div);
            });
        }
        
        function render() {
            renderCards(document.getElementById("playerCards"), player, false);
            renderCards(document.getElementById("dealerCards"), dealer, dealerHidden);
            
            const playerTotal = handTotal(player);
            document.getElementById("playerTotal").textContent = `Total: ${playerTotal}`;
            
            // Color code player total
            const playerTotalEl = document.getElementById("playerTotal");
            playerTotalEl.className = "hand-total";
            if (playerTotal > 21) {
                playerTotalEl.classList.add("lose");
            } else if (playerTotal === 21) {
                playerTotalEl.classList.add("win");
            }
            
            if (dealerHidden) {
                document.getElementById("dealerTotal").textContent = "Total: ?";
            } else {
                const dealerTotal = handTotal(dealer);
                document.getElementById("dealerTotal").textContent = `Total: ${dealerTotal}`;
                
                // Color code dealer total
                const dealerTotalEl = document.getElementById("dealerTotal");
                dealerTotalEl.className = "hand-total";
                if (dealerTotal > 21) {
                    dealerTotalEl.classList.add("lose");
                } else if (dealerTotal === 21) {
                    dealerTotalEl.classList.add("win");
                }
            }
            
            // Show/hide double button (only available on first move)
            document.getElementById("double").style.display = 
                (player.length === 2 && chips >= currentBet && gameActive) ? "inline-flex" : "none";
        }
        
        function startGame() {
            if (deck.length < 15) {
                createDeck();
                playSound("shuffle");
            }
            
            player = [drawCard(), drawCard()];
            dealer = [drawCard(), drawCard()];
            dealerHidden = true;
            gameActive = true;
            
            document.getElementById("result").textContent = "";
            document.getElementById("result").className = "";
            
            document.getElementById("hit").disabled = false;
            document.getElementById("stand").disabled = false;
            document.getElementById("restart").style.display = "none";
            
            // Check for blackjack
            if (handTotal(player) === 21) {
                setTimeout(() => {
                    dealerHidden = false;
                    render();
                    
                    if (handTotal(dealer) === 21) {
                        finish("Blackjack Push!", "push");
                    } else {
                        chips += Math.floor(currentBet * 1.5);
                        updateChips();
                        finish("Blackjack! You win!", "win");
                        playSound("win");
                    }
                }, 1000);
            }
            
            gamesPlayed++;
            document.getElementById("gamesPlayed").textContent = gamesPlayed;
            
            render();
            playSound("deal");
        }
        
        function drawCard() {
            if (deck.length === 0) createDeck();
            const card = deck.pop();
            updateDeckCount();
            return card;
        }
        
        function finish(msg, cls = "") {
            dealerHidden = false;
            gameActive = false;
            render();
            
            const r = document.getElementById("result");
            r.textContent = msg;
            r.className = cls;
            
            document.getElementById("hit").disabled = true;
            document.getElementById("stand").disabled = true;
            document.getElementById("double").style.display = "none";
            document.getElementById("restart").style.display = "inline-flex";
            
            // Play appropriate sound
            if (cls === "win") playSound("win");
            else if (cls === "lose") playSound("lose");
            else playSound("push");
        }
        
        function updateChips() {
            document.getElementById("chipCount").textContent = chips;
            
            // Update chip color based on amount
            const chipEl = document.getElementById("chipCount");
            if (chips >= 150) {
                chipEl.style.color = "#4caf50";
            } else if (chips >= 50) {
                chipEl.style.color = "#ff9800";
            } else if (chips > 0) {
                chipEl.style.color = "#e91e63";
            } else {
                chipEl.style.color = "#9e9e9e";
            }
        }
        
        function updateDeckCount() {
            document.getElementById("deckCount").textContent = deck.length;
        }
        
        // Sound functions
        function playSound(type) {
            if (!soundEnabled) return;
            
            console.log(`Playing sound: ${type}`);

        }
        
        // Event listeners
        document.getElementById("hit").onclick = () => {
            if (!gameActive) return;
            
            player.push(drawCard());
            render();
            playSound("card");
            
            if (handTotal(player) > 21) {
                chips -= currentBet;
                updateChips();
                finish("You busted!", "lose");
            }
        };
        
        document.getElementById("stand").onclick = () => {
            if (!gameActive) return;
            
            dealerHidden = false;
            
            // Dealer draws until 17 or higher
            while (handTotal(dealer) < 17) {
                dealer.push(drawCard());
                render();
            }
            
            const p = handTotal(player);
            const d = handTotal(dealer);
            
            if (d > 21) {
                chips += currentBet;
                updateChips();
                finish("Dealer busted — you win!", "win");
            } else if (p > d) {
                chips += currentBet;
                updateChips();
                finish("You win!", "win");
            } else if (p < d) {
                chips -= currentBet;
                updateChips();
                finish("Dealer wins!", "lose");
            } else {
                finish("Push!", "push");
            }
        };
        
        document.getElementById("double").onclick = () => {
            if (!gameActive || player.length !== 2 || chips < currentBet) return;
            
            // Double the bet
            currentBet *= 2;
            document.getElementById("currentBet").textContent = currentBet;
            
            // Take one more card
            player.push(drawCard());
            render();
            playSound("card");
            
            // Then stand automatically
            if (handTotal(player) > 21) {
                chips -= currentBet;
                updateChips();
                currentBet = Math.floor(currentBet / 2); // Reset bet
                document.getElementById("currentBet").textContent = currentBet;
                finish("You busted after doubling!", "lose");
            } else {
                // Trigger stand logic
                document.getElementById("stand").onclick();
            }
        };
        
        document.getElementById("restart").onclick = () => {
            currentBet = 10;
            document.getElementById("currentBet").textContent = currentBet;
            startGame();
        };
        
        document.getElementById("soundToggle").onclick = () => {
            soundEnabled = !soundEnabled;
            const icon = document.querySelector("#soundToggle i");
            icon.className = soundEnabled ? "fas fa-volume-up" : "fas fa-volume-mute";
            playSound("click");
        };
        
        document.getElementById("highContrast").onclick = () => {
            highContrastMode = !highContrastMode;
            document.body.classList.toggle("high-contrast", highContrastMode);
            playSound("click");
        };
        
        document.getElementById("helpBtn").onclick = () => {
            alert("BLACKJACK RULES:\n\n• Try to get as close to 21 as possible without going over.\n• Number cards are worth their face value, face cards are worth 10, and Aces are worth 1 or 11.\n• You can Hit to take another card, or Stand to keep your current hand.\n• You can Double your bet on your first move to take exactly one more card.\n• Dealer must hit until they have 17 or higher.\n• Blackjack (Ace + 10-value card) pays 3:2.");
            playSound("click");
        };
        
        document.getElementById("betBtn").onclick = () => {
            if (gameActive) {
                alert("You can only change your bet between games.");
                return;
            }
            
            const newBet = prompt("Enter new bet amount (5-50 chips):", currentBet);
            if (newBet && !isNaN(newBet) && newBet >= 5 && newBet <= 50 && newBet <= chips) {
                currentBet = parseInt(newBet);
                document.getElementById("currentBet").textContent = currentBet;
                playSound("click");
            } else if (newBet) {
                alert("Invalid bet amount. Please enter a number between 5 and 50, and make sure you have enough chips.");
            }
        };
        
        // Keyboard accessibility
        document.addEventListener("keydown", (e) => {
            if (!gameActive && e.key === "Enter") {
                document.getElementById("restart").click();
            } else if (gameActive) {
                switch(e.key.toLowerCase()) {
                    case "h":
                        document.getElementById("hit").click();
                        break;
                    case "s":
                        document.getElementById("stand").click();
                        break;
                    case "d":
                        document.getElementById("double").click();
                        break;
                }
            }
        });
        
        // Initialize the game
        initGame();
    </script>
</body>

</html>