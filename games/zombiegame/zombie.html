<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zombie Survival</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" href="../../icon.jpg" type="image/x-icon">
  <style>
    * {
      box-sizing: border-box;
      /* keep control of fonts via body below */
    }

    body {
      font-family: 'DM Sans', sans-serif;
      margin: 0;
      background: radial-gradient(circle at top, #1b1b1b, #000);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    canvas {
      background: #0d0d0d;
      border-radius: 16px;
      box-shadow: 0 0 40px rgba(0, 0, 0, .8);
    }

    button {
      font-family: inherit;
      font-weight: 700;
    }

    .hud {
      position: absolute;
      top: 16px;
      left: 16px;
      font-weight: 600;
      font-size: 16px;
    }

    .hud div {
      margin-bottom: 6px;
    }
  </style>
</head>

<body>
  <div class="hud">
    <div id="health">‚ù§Ô∏è Health: 100</div>
    <div id="score">üßü Kills: 0</div>
    <div id="helpers">üßë Allies: 0</div>
  </div>
  <canvas id="game" width="900" height="550"></canvas>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const keys = {};
    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    const player = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      r: 16,
      speed: 3.2,
      health: 100
    };

    let bullets = [];
    let zombies = [];
    let humans = [];
    let kills = 0;
    let frame = 0;
    let spawnRate = 90;

    canvas.addEventListener('click', e => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      const angle = Math.atan2(my - player.y, mx - player.x);
      bullets.push({
        x: player.x,
        y: player.y,
        vx: Math.cos(angle) * 7,
        vy: Math.sin(angle) * 7,
        r: 4
      });
    });

    function spawnZombie() {
      const edge = Math.floor(Math.random() * 4);
      let x, y;
      if (edge === 0) { x = 0; y = Math.random() * canvas.height; }
      if (edge === 1) { x = canvas.width; y = Math.random() * canvas.height; }
      if (edge === 2) { x = Math.random() * canvas.width; y = 0; }
      if (edge === 3) { x = Math.random() * canvas.width; y = canvas.height; }

      const roll = Math.random();
      let type = 'normal';
      if (roll < 0.2) type = 'virus';
      else if (roll < 0.35) type = 'fast';
      else if (roll < 0.45) type = 'cure';

      zombies.push({
        x, y,
        r: 18,
        type,
        speed: type === 'fast' ? 2.2 : 1.2,
        emoji: 'üßü'
      });
    }

    function update() {
      frame++;
      if (frame % spawnRate === 0) spawnZombie();


      if (keys['ArrowUp']) player.y -= player.speed;
      if (keys['ArrowLeft']) player.x -= player.speed;
      if (keys['ArrowDown']) player.y += player.speed;
      if (keys['ArrowRight']) player.x += player.speed;


      player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x));
      player.y = Math.max(player.r, Math.min(canvas.height - player.r, player.y));


      bullets.forEach(b => { b.x += b.vx; b.y += b.vy; });
      bullets = bullets.filter(b => b.x > 0 && b.x < canvas.width && b.y > 0 && b.y < canvas.height);


      zombies.forEach((z, zi) => {
        const angle = Math.atan2(player.y - z.y, player.x - z.x);
        z.x += Math.cos(angle) * z.speed;
        z.y += Math.sin(angle) * z.speed;

        if (Math.hypot(player.x - z.x, player.y - z.y) < player.r + z.r) {
          if (z.type === 'virus') player.health -= 0.35;
          else player.health -= 0.18;
        }
      });


      humans.forEach(h => {
        const target = zombies[0];
        if (!target) return;
        const a = Math.atan2(target.y - h.y, target.x - h.x);
        h.x += Math.cos(a) * 1.4;
        h.y += Math.sin(a) * 1.4;

        if (Math.hypot(h.x - target.x, h.y - target.y) < h.r + target.r) {
          zombies.shift();
          kills++;
        }
      });


      bullets.forEach((b, bi) => {
        zombies.forEach((z, zi) => {
          if (Math.hypot(b.x - z.x, b.y - z.y) < b.r + z.r) {
            bullets.splice(bi, 1);

            if (z.type === 'cure' && Math.random() < 0.09) {
              humans.push({ x: z.x, y: z.y, r: 16, emoji: 'üßë' });
            } else {
              kills++;
            }
            zombies.splice(zi, 1);
          }
        });
      });

      spawnRate = Math.max(25, 90 - Math.floor(kills / 4));
    }

    function drawEmoji(emoji, x, y, size) {
      ctx.font = size + 'px DM Sans';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(emoji, x, y);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);


      drawEmoji('üßë', player.x, player.y, 26);


      ctx.fillStyle = '#facc15';
      bullets.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fill();
      });


      zombies.forEach(z => drawEmoji(z.emoji, z.x, z.y, 28));


      humans.forEach(h => drawEmoji(h.emoji, h.x, h.y, 26));

      document.getElementById('health').textContent = `‚ù§Ô∏è Health: ${Math.max(0, player.health.toFixed(0))}`;
      document.getElementById('score').textContent = `üßü Kills: ${kills}`;
      document.getElementById('helpers').textContent = `üßë Allies: ${humans.length}`;
    }

    function loop() {
      if (player.health <= 0) {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        ctx.font = '48px DM Sans';
        ctx.textAlign = 'center';
        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2);
        ctx.font = '20px DM Sans';
        ctx.fillText(`Kills: ${kills}`, canvas.width / 2, canvas.height / 2 + 36);
        return;
      }
      update();
      draw();
      requestAnimationFrame(loop);
    }

    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => keys[e.key] = false);

    loop();
  </script>
</body>

</html>