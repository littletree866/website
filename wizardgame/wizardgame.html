<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard Battle</title>
    <link rel="stylesheet" href="wizardgame.css">
    <link rel="icon" href="check.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
            }
            
            .spell-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .spell-btn {
                font-size: 0.9rem;
                padding: 8px;
            }
        }
        
        .preload-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .spell-effect {
            position: absolute;
            pointer-events: none;
            animation: spellFade 0.8s forwards;
        }

        @keyframes spellFade {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 0; }
        }

        .spell-btn {
            position: relative;
            overflow: hidden;
        }

        .spell-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }

        .spell-btn:not(:disabled):hover::after {
            transform: translateX(100%);
        }

        .enemy {
            transition: all 0.3s ease;
        }

        .enemy.damaged {
            animation: damage 0.3s ease-in-out;
        }

        @keyframes damage {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .spell-emoji {
            text-shadow: 0 0 10px #ffd700,
                         0 0 20px #ffd700,
                         0 0 30px #ff8c00;
            font-size: 1.5em;
            animation: spellGlow 0.8s forwards;
        }

        @keyframes spellGlow {
            0% { opacity: 0; transform: scale(0.5); filter: brightness(1.5); }
            50% { opacity: 1; transform: scale(1.2); filter: brightness(2); }
            100% { opacity: 0; transform: scale(1); filter: brightness(1.5); }
        }
    </style>
</head>
<body>
    <div id="preload" class="preload-overlay">Loading game resources...</div>
    <div class="map-container" id="map-container">
        <h1>World Map</h1>
        <div class="map" id="map">
            <!-- Map will be generated here -->
        </div>
        <div class="map-log" id="map-log">
            <p>Explore the mystical world to find enemies and treasures!</p>
        </div>
        <div class="inventory-shop">
            <div class="inventory" id="inventory">
                <h3>Inventory</h3>
                <!-- Inventory items will be added -->
            </div>
            <div class="shop" id="shop">
                <h3>Magic Shop</h3>
                <!-- Shop items will be added here -->
            </div>
        </div>
        <button class="action-btn" id="return-to-battle" style="display: none;">Return to Battle</button>
    </div>

    <div class="game-container" id="game-container" style="display: none;">
        <h1>Arcane Duel</h1>
        <div class="game-info">
            <div class="player-stats">
                <h2>Arcane Mage</h2>
                <div style="display:flex;gap:8px;margin-top:6px;">
                    <button class="action-btn" id="save-wizard" style="padding:6px 10px;font-size:0.9rem;">Save</button>
                    <button class="action-btn" id="load-wizard" style="padding:6px 10px;font-size:0.9rem;">Load</button>
                </div>
                <p>Level: <span id="player-level">1</span></p>
                <p>Health: <span id="player-health-text">100</span>/<span id="player-max-health">100</span></p>
                <div class="health-bar">
                    <div class="health-fill" id="player-health"></div>
                </div>
                <p>Mana: <span id="player-mana-text">100</span>/<span id="player-max-mana">100</span></p>
                <div class="mana-bar">
                    <div class="mana-fill" id="player-mana"></div>
                </div>
                <p>XP: <span id="player-xp">0</span>/<span id="player-xp-needed">100</span></p>
                <div class="xp-bar">
                    <div class="xp-fill" id="xp-fill"></div>
                </div>
                <p>Gold: <span id="player-gold">0</span></p>
            </div>
            <div class="enemy-stats">
                <h2 id="enemy-name">Minion</h2>
                <p>Health: <span id="enemy-health-text">50</span>/<span id="enemy-max-health">50</span></p>
                <div class="health-bar">
                    <div class="health-fill" id="enemy-health"></div>
                </div>
                <p id="enemy-status">Status: Normal</p>
            </div>
        </div>
        <div class="game-area">
            <div class="battle-area">
                <div class="player" id="player">üßô‚Äç‚ôÇÔ∏è</div>
                <div class="enemy" id="enemy">üëπ</div>
            </div>
            <div class="spell-buttons">
                <button class="spell-btn" id="fireball">Fireball (15 mana)</button>
                <button class="spell-btn" id="frostbolt">Frostbolt (7 mana)</button>
                <button class="spell-btn" id="lightning">Lightning (15 mana)</button>
                <button class="spell-btn" id="heal">Heal (20 mana)</button>
                <!-- Powerful spells will be added here by JavaScript -->
            </div>
            <button class="action-btn" id="next-enemy">Next Enemy</button>
            <button class="action-btn" id="rest">Meditate</button>
            <button class="action-btn" id="use-potion">Use Health Potion</button>
        </div>
        <div class="game-log" id="game-log">
            <p class="special">Welcome to Arcane Duel! Defeat enemies to gain XP and unlock powerful spells.</p>
        </div>
    </div>
    <script src="wizardgame.js"></script>
    <script>
        window.addEventListener('load', () => {
            document.getElementById('preload').style.display = 'none';
        });
        
        // Add touch event support
        document.addEventListener('touchstart', (e) => {
            if (e.target.classList.contains('spell-btn')) {
                e.preventDefault();
            }
        }, { passive: false });

        // Helper: create a non-blocking spell visual effect and remove it after animation.
        function createSpellEffect(type, targetEl) {
            try {
                const effect = document.createElement('div');
                effect.className = 'spell-effect';
                // position in center of target element if present, otherwise center of screen
                const rect = targetEl ? targetEl.getBoundingClientRect() : null;
                effect.style.left = rect ? `${rect.left + rect.width / 2}px` : '50%';
                effect.style.top = rect ? `${rect.top + rect.height / 2}px` : '50%';
                effect.style.width = '100px';
                effect.style.height = '100px';
                effect.style.position = 'fixed';
                effect.style.transform = 'translate(-50%, -50%)';
                effect.style.borderRadius = '50%';
                effect.style.pointerEvents = 'none';
                effect.style.zIndex = 9999;
                if (type === 'fire') {
                    effect.style.background = 'radial-gradient(circle, #ff4400, transparent)';
                } else if (type === 'ice') {
                    effect.style.background = 'radial-gradient(circle, #00ffff, transparent)';
                } else if (type === 'lightning') {
                    effect.style.background = 'radial-gradient(circle, #ffff80, transparent)';
                } else {
                    effect.style.background = 'radial-gradient(circle, rgba(255,255,255,0.2), transparent)';
                }
                document.body.appendChild(effect);
                setTimeout(()=> effect.remove(), 800);
            } catch (err) {
                // fail silently to avoid breaking game logic
                console.warn('createSpellEffect failed', err);
            }
        }

        // Helper: animate enemy damaged state safely
        function flashEnemyDamaged(enemyEl) {
            if (!enemyEl) return;
            enemyEl.classList.add('damaged');
            setTimeout(()=> enemyEl.classList.remove('damaged'), 300);
        }

        // Expose helpers to global scope so existing game code can call them if desired
        window.createSpellEffect = createSpellEffect;
        window.flashEnemyDamaged = flashEnemyDamaged;

        // Simple wizard save/load
        const WIZARD_SAVE_KEY = 'wizard_save_v1';
        document.getElementById('save-wizard').addEventListener('click', ()=>{
            const data = {
                level: Number(document.getElementById('player-level').textContent) || 1,
                xp: Number(document.getElementById('player-xp').textContent) || 0,
                gold: Number(document.getElementById('player-gold').textContent) || 0
            };
            localStorage.setItem(WIZARD_SAVE_KEY, JSON.stringify(data));
            alert('Wizard saved');
        });
        document.getElementById('load-wizard').addEventListener('click', ()=>{
            const s = localStorage.getItem(WIZARD_SAVE_KEY);
            if (!s) { alert('No save found'); return; }
            try {
                const obj = JSON.parse(s);
                document.getElementById('player-level').textContent = obj.level || 1;
                document.getElementById('player-xp').textContent = obj.xp || 0;
                document.getElementById('player-gold').textContent = obj.gold || 0;
                alert('Wizard loaded');
            } catch(e){ alert('Load failed'); }
        });
    </script>
</body>
</html>
